#
# Makefile rules for the PARIInterface package
#
KEXT_NAME = PARIInterface
KEXT_SOURCES = src/PARIInterface.c

TOP = $(shell pwd)
KEXT_CFLAGS =
KEXT_LDFLAGS =
EXTERN_FILES =

# include shared GAP package build system
GAPPATH = @GAPPATH@
include Makefile.gappkg


########################################################################
# PARI
########################################################################
ifeq ($(BUILD_PARI),yes)
PARI_PREFIX := extern/install
PARI_FILES := $(PARI_PREFIX)/lib/libpari.*
PARI_CPPFLAGS = -I $(PARI_PREFIX)/include
PARI_LDFLAGS = -R $(TOP)/$(PARI_PREFIX)/lib -L$(PARI_PREFIX)/lib -lpari

KEXT_CFLAGS += $(PARI_CPPFLAGS)
KEXT_LDFLAGS += $(PARI_LDFLAGS)
EXTERN_FILES += $(PARI_FILES)

########################################################################
#
# We support getting a recent version of PARI and building it
# as part of the package
#
pari: $(PARI_FILES)
$(PARI_FILES):
	etc/build_pari.sh $(GAPPATH)

pariclean:
	rm -rf $(PARI_PREFIX)
.PHONY: pariclean

else
ifneq ($(PARI_PREFIX),)
PARI_CPPFLAGS = -I$(PARI_PREFIX)/include
PARI_LDFLAGS = -L$(PARI_PREFIX)/lib -lpari

KEXT_CFLAGS += $(PARI_CPPFLAGS)
KEXT_LDFLAGS += $(PARI_LDFLAGS)
else

KEXT_LDFLAGS += -lpari

pari:
	echo "Using system PARI, nothing to be done"

endif
endif

$(KEXT_OBJS): $(EXTERN_FILES)
$(KEXT_SO): $(EXTERN_FILES)
