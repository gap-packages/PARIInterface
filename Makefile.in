#
# Makefile rules for the PARIInterface package
#
KEXT_NAME = PARIInterface
KEXT_SOURCES = src/PARIInterface.c

KEXT_CFLAGS =
KEXT_LDFLAGS =
EXTERN_FILES =

# include shared GAP package build system
GAPPATH = @GAPPATH@
PARIPATH = @PARIPATH@
KEXT_RECONF ?= ./configure --with-gaproot="$(GAPPATH)" --with-pari="$(PARIPATH)"
include Makefile.gappkg


########################################################################
# PARI
########################################################################
ifeq ($(PARIPATH),builtin)
BUILD_PARI := yes
else
PARI_PREFIX := $(PARIPATH)
endif

ifeq ($(BUILD_PARI),yes)
PARI_PREFIX := extern/install
PARI_FILES := $(PARI_PREFIX)/lib/libpari.*
PARI_CPPFLAGS = -I$(PARI_PREFIX)/include
PARI_LDFLAGS = -Wl,-rpath -Wl,$(PARI_PREFIX)/lib -L$(PARI_PREFIX)/lib -lpari

KEXT_CFLAGS += $(PARI_CPPFLAGS)
KEXT_LDFLAGS += $(PARI_LDFLAGS)
EXTERN_FILES += $(PARI_FILES)

########################################################################
#
# We support getting a recent version of PARI and building it
# as part of the package
#
pari: $(PARI_FILES)
$(PARI_FILES):
	etc/build_pari.sh $(GAPPATH)

pariclean:
	rm -rf $(PARI_PREFIX)
.PHONY: pariclean

else
ifneq ($(PARI_PREFIX),)
PARI_CPPFLAGS = -I$(PARI_PREFIX)/include
PARI_LDFLAGS = -Wl,-rpath -Wl,$(PARI_PREFIX)/lib -L$(PARI_PREFIX)/lib -lpari

KEXT_CFLAGS += $(PARI_CPPFLAGS)
KEXT_LDFLAGS += $(PARI_LDFLAGS)
else

KEXT_LDFLAGS += -lpari
endif

pari:
	echo "Using system PARI, nothing to be done"

endif

$(KEXT_OBJS): $(EXTERN_FILES)
$(KEXT_SO): $(EXTERN_FILES)
